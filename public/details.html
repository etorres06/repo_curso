<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Detalles completos del videojuego">
    <title>Detalle del Juego</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Spinner de carga */
        .spinner-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            gap: 20px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 500;
        }

        /* Mensajes de error */
        .error-container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .error-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .error-title {
            color: #e53e3e;
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .error-message {
            color: #4a5568;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Tarjeta principal */
        .game-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header con imagen de fondo */
        .game-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .game-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" fill="%23ffffff" fill-opacity="0.1"/></svg>');
            background-size: cover;
            opacity: 0.1;
        }

        .game-header h1 {
            font-size: 36px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .game-genre {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
        }

        /* Contenido principal */
        .game-content {
            padding: 40px;
        }

        .game-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .meta-item {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .meta-label {
            color: #718096;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .meta-value {
            color: #2d3748;
            font-size: 18px;
            font-weight: 600;
        }

        .price {
            color: #48bb78;
            font-size: 28px;
        }

        .game-description {
            background: #f7fafc;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .game-description h2 {
            color: #2d3748;
            font-size: 20px;
            margin-bottom: 15px;
        }

        .game-description p {
            color: #4a5568;
            line-height: 1.8;
            font-size: 16px;
        }

        /* Lista de detalles adicionales */
        .game-details {
            list-style: none;
            margin-bottom: 30px;
        }

        .game-details li {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-details li:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #718096;
            font-weight: 500;
        }

        .detail-value {
            color: #2d3748;
            font-weight: 600;
        }

        /* Botones de acci√≥n */
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            padding: 30px 40px;
            background: #f7fafc;
            border-top: 1px solid #e2e8f0;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4);
        }

        /* Modal de confirmaci√≥n */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            max-width: 400px;
            text-align: center;
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .modal-message {
            color: #718096;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-header h1 {
                font-size: 28px;
            }

            .game-content {
                padding: 20px;
            }

            .action-buttons {
                padding: 20px;
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
        <!--
            public/details.html

            P√°gina de detalle de un juego.

            Descripci√≥n:
            - Recupera el ID desde la query string (?id=) y solicita los datos al endpoint
                correspondiente. Renderiza la tarjeta principal y una lista de campos adicionales.
            - IDs importantes: #gameCard, #loadingSpinner, #errorContainer, #additionalDetails.
            - La funci√≥n renderAdditionalFields muestra campos din√°micos que no est√°n en la UI fija.
        -->
        <div class="container">
        <!-- Spinner de carga -->
        <div id="loadingSpinner" class="spinner-container">
            <div class="spinner"></div>
            <p class="loading-text">Cargando detalles del juego...</p>
        </div>

        <!-- Contenedor de error -->
        <div id="errorContainer" class="error-container hidden">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h2 class="error-title" id="errorTitle">Error</h2>
            <p class="error-message" id="errorMessage"></p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-primary" onclick="retryLoad()">üîÑ Reintentar</button>
                <a href="index.html" class="btn btn-secondary">‚Üê Volver a la lista</a>
            </div>
        </div>

        <!-- Tarjeta del juego -->
        <article id="gameCard" class="game-card hidden">
            <header class="game-header">
                <h1 id="gameName">Nombre del Juego</h1>
                <span class="game-genre" id="gameGenre">G√©nero</span>
            </header>

            <div class="game-content">
                <!-- Metadatos principales -->
                <div class="game-meta">
                    <div class="meta-item">
                        <div class="meta-label">Precio</div>
                        <div class="meta-value price" id="gamePrice">$0.00</div>
                    </div>
                    <div class="meta-item" id="ratingContainer" style="display: none;">
                        <div class="meta-label">Calificaci√≥n</div>
                        <div class="meta-value" id="gameRating">‚≠ê 0.0</div>
                    </div>
                    <div class="meta-item" id="dateContainer" style="display: none;">
                        <div class="meta-label">Fecha de lanzamiento</div>
                        <div class="meta-value" id="gameDate">-</div>
                    </div>
                </div>

                <!-- Descripci√≥n -->
                <section class="game-description">
                    <h2>Descripci√≥n</h2>
                    <p id="gameDescription">Sin descripci√≥n disponible.</p>
                </section>

                <!-- Detalles adicionales (campos din√°micos) -->
                <ul class="game-details" id="additionalDetails">
                    <!-- Se llenar√°n din√°micamente -->
                </ul>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="action-buttons">
                <a href="index.html" class="btn btn-secondary">‚Üê Volver a la lista</a>
                <a href="#" id="editBtn" class="btn btn-primary">‚úèÔ∏è Editar</a>
                <button class="btn btn-danger" onclick="confirmDelete()">üóëÔ∏è Eliminar</button>
            </div>
        </article>
    </div>

    <!-- Modal de confirmaci√≥n de eliminaci√≥n -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">‚ö†Ô∏è</div>
            <h3 class="modal-title">¬øEliminar juego?</h3>
            <p class="modal-message">Esta acci√≥n no se puede deshacer. El juego ser√° eliminado permanentemente.</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                <button class="btn btn-danger" onclick="deleteGame()">Eliminar</button>
            </div>
        </div>
    </div>

            <script>
                    /*
                        L√≥gica de details.html (versi√≥n para un desarrollador junior)

                        Resumen sencillo:
                        - Obtenemos el par√°metro "id" de la URL y pedimos los datos al backend.
                        - Si recibimos el juego, lo mostramos en la tarjeta #gameCard.
                        - Si el backend devuelve campos extra, los mostramos autom√°ticamente en #additionalDetails.

                        Consejos pr√°cticos:
                        - Para depurar, abr√≠ DevTools y comprob√° la petici√≥n fetch a `${API_URL}/{id}`.
                        - Si agreg√°s un campo nuevo en el backend, aparecer√° en "Detalles adicionales" sin tocar c√≥digo.
                    */

                    // Cambiar la URL base de la API para usar el prefijo correcto
                    const API_URL = '/api/juegos';

        // Configuraci√≥n de la API
        let currentGameId = null;

        // Elementos del DOM
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorContainer = document.getElementById('errorContainer');
        const gameCard = document.getElementById('gameCard');
        const deleteModal = document.getElementById('deleteModal');

        /**
         * Inicializaci√≥n: obtiene el ID de la URL y carga el juego
         */
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            currentGameId = urlParams.get('id');

            // Validar que exista el ID
            if (!currentGameId) {
                showError(
                    'ID no especificado',
                    'No se proporcion√≥ un ID de juego en la URL. Por favor, selecciona un juego de la lista.',
                    false
                );
                return;
            }

            // Configurar bot√≥n de edici√≥n
            document.getElementById('editBtn').href = `edit.html?id=${currentGameId}`;

            // Cargar datos del juego
            loadGameDetails();
        });

        /**
         * Carga los detalles del juego desde la API
         */
        async function loadGameDetails() {
            try {
                showLoading();

                // Petici√≥n al backend para obtener el juego por ID
                const response = await fetch(`${API_URL}/${currentGameId}`);
                const data = await response.json();

                // El backend puede devolver { mensaje, juego } o directamente el objeto juego
                const game = data.juego || data;

                // Manejo simple de errores HTTP:
                if (response.status === 404) {
                    // Mostrar UI espec√≠fica de "no encontrado" para que el usuario entienda
                    showError(
                        'Juego no encontrado',
                        'El juego que buscas no existe o fue eliminado.',
                        false
                    );
                    return;
                }

                if (!response.ok) {
                    // Para otros c√≥digos (500, 400, etc.) lanzamos y lo manejamos abajo
                    throw new Error(`Error del servidor: ${response.status}`);
                }

                // Si todo fue bien, renderizamos el juego en la p√°gina
                renderGame(game);

            } catch (error) {
                // Errores comunes: problema de red, backend ca√≠do o respuesta malformada
                console.error('Error al cargar el juego:', error);
                showError(
                    'Error de conexi√≥n',
                    'No se pudo conectar con el servidor. Verifica tu conexi√≥n a internet e intenta nuevamente.',
                    true
                );
            }
        }

        /**
         * Renderiza los detalles del juego en la interfaz
         */
        function renderGame(game) {
            // Campos principales
            document.getElementById('gameName').textContent = game.nombre || 'Sin nombre';
            document.getElementById('gameGenre').textContent = game.genero || 'Sin g√©nero';
            document.getElementById('gamePrice').textContent = 
                game.precio ? `$${parseFloat(game.precio).toFixed(2)}` : 'Gratis';
            document.getElementById('gameDescription').textContent = 
                game.descripcion || 'Sin descripci√≥n disponible.';

            // Actualizar meta tag del t√≠tulo
            document.title = `${game.nombre} - Detalle del Juego`;

            // Campos opcionales: Rating
            if (game.rating !== undefined && game.rating !== null) {
                const ratingContainer = document.getElementById('ratingContainer');
                ratingContainer.style.display = 'block';
                document.getElementById('gameRating').textContent = 
                    `‚≠ê ${parseFloat(game.rating).toFixed(1)}`;
            }

            // Campos opcionales: Fecha de lanzamiento
            if (game.fecha_lanzamiento || game.fechaLanzamiento || game.fecha) {
                const dateContainer = document.getElementById('dateContainer');
                dateContainer.style.display = 'block';
                const fecha = game.fecha_lanzamiento || game.fechaLanzamiento || game.fecha;
                document.getElementById('gameDate').textContent = formatDate(fecha);
            }

            // Renderizar campos adicionales din√°micamente
            renderAdditionalFields(game);

            // Mostrar la tarjeta
            showGame();
        }

        /**
         * Renderiza campos adicionales que no est√°n predefinidos
         * √ötil para campos como desarrollador, plataforma, imagen, etc.
         */
        function renderAdditionalFields(game) {
            const additionalDetails = document.getElementById('additionalDetails');
            additionalDetails.innerHTML = '';

            // Lista de campos que ya se muestran en la UI principal
            const displayedFields = ['id', 'nombre', 'genero', 'precio', 'descripcion', 
                                    'rating', 'fecha_lanzamiento', 'fechaLanzamiento', 'fecha'];

            // Iterar sobre todos los campos del objeto
            Object.keys(game).forEach(key => {
                if (!displayedFields.includes(key)) {
                    const value = game[key];
                    
                    // Solo mostrar si tiene valor
                    if (value !== null && value !== undefined && value !== '') {
                        const li = document.createElement('li');
                        
                        const label = document.createElement('span');
                        label.className = 'detail-label';
                        label.textContent = formatFieldName(key);
                        
                        const valueSpan = document.createElement('span');
                        valueSpan.className = 'detail-value';
                        
                        // Formatear seg√∫n el tipo de dato
                        if (typeof value === 'boolean') {
                            valueSpan.textContent = value ? '‚úì S√≠' : '‚úó No';
                        } else if (typeof value === 'object') {
                            valueSpan.textContent = JSON.stringify(value);
                        } else if (key.toLowerCase().includes('url') || key.toLowerCase().includes('imagen')) {
                            // Si es una URL, crear un enlace o mostrar imagen
                            if (key.toLowerCase().includes('imagen')) {
                                const img = document.createElement('img');
                                img.src = value;
                                img.alt = game.nombre;
                                img.style.maxWidth = '200px';
                                img.style.borderRadius = '8px';
                                valueSpan.appendChild(img);
                            } else {
                                const link = document.createElement('a');
                                link.href = value;
                                link.textContent = 'Ver enlace';
                                link.target = '_blank';
                                link.style.color = '#667eea';
                                valueSpan.appendChild(link);
                            }
                        } else {
                            valueSpan.textContent = value;
                        }
                        
                        li.appendChild(label);
                        li.appendChild(valueSpan);
                        additionalDetails.appendChild(li);
                    }
                }
            });

            // Si no hay campos adicionales, ocultar la lista
            if (additionalDetails.children.length === 0) {
                additionalDetails.style.display = 'none';
            }
        }

        /**
         * Formatea el nombre de un campo para mostrarlo al usuario
         */
        function formatFieldName(fieldName) {
            return fieldName
                .replace(/_/g, ' ')
                .replace(/([A-Z])/g, ' $1')
                .toLowerCase()
                .split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        /**
         * Formatea una fecha para mostrarla de forma legible
         */
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('es-ES', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            } catch {
                return dateString;
            }
        }

        /**
         * Muestra el modal de confirmaci√≥n de eliminaci√≥n
         */
        function confirmDelete() {
            deleteModal.classList.add('active');
        }

        /**
         * Cierra el modal de confirmaci√≥n
         */
        function closeModal() {
            deleteModal.classList.remove('active');
        }

        /**
         * Elimina el juego tras confirmaci√≥n
         */
        async function deleteGame() {
            try {
                closeModal();
                showLoading();

                const response = await fetch(`${API_URL}/${currentGameId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // Agregar confirmaci√≥n que requiere el backend
                    body: JSON.stringify({ confirmacion: true })
                });

                if (!response.ok) {
                    throw new Error('Error al eliminar el juego');
                }

                // Redirigir a la lista con mensaje de √©xito
                alert('‚úì Juego eliminado correctamente');
                window.location.href = 'index.html';

            } catch (error) {
                console.error('Error al eliminar:', error);
                showError(
                    'Error al eliminar',
                    'No se pudo eliminar el juego. Intenta nuevamente.',
                    true
                );
            } finally {
                deleteModal.classList.remove('active');
            }
        }

        /**
         * Reintenta cargar los datos del juego
         */
        function retryLoad() {
            loadGameDetails();
        }

        // Funciones de control de vista

        function showLoading() {
            loadingSpinner.classList.remove('hidden');
            errorContainer.classList.add('hidden');
            gameCard.classList.add('hidden');
        }

        function showError(title, message, canRetry) {
            loadingSpinner.classList.add('hidden');
            gameCard.classList.add('hidden');
            errorContainer.classList.remove('hidden');
            
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorMessage').textContent = message;
        }

        function showGame() {
            loadingSpinner.classList.add('hidden');
            errorContainer.classList.add('hidden');
            gameCard.classList.remove('hidden');
        }

        // Cerrar modal al hacer clic fuera de √©l
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                closeModal();
            }
        });

        // Cerrar modal con tecla ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && deleteModal.classList.contains('active')) {
                closeModal();
            }
        });
    </script>
</body>
</html>